<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Asseta | Enterprise v3.0</title>

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --primary-dark: #4f46e5;
            --secondary: #ec4899;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #0f172a;
            
            --bg-body: #f8fafc;
            --bg-sidebar: #ffffff;
            --bg-card: #ffffff;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --border: #e2e8f0;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            --shadow-lg: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
        }

        body.dark-theme {
            --bg-body: #020617;
            --bg-sidebar: #0f172a;
            --bg-card: #1e293b;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --border: #334155;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        
        body { background-color: var(--bg-body); color: var(--text-main); overflow-x: hidden; line-height: 1.5; }

        /* LAYOUT */
        .wrapper { display: flex; min-height: 100vh; }

        .sidebar {
            width: 280px; background: var(--bg-sidebar); border-right: 1px solid var(--border);
            height: 100vh; position: fixed; z-index: 50; padding: 32px 24px;
            display: flex; flex-direction: column; transition: 0.3s;
        }

        .logo { font-size: 24px; font-weight: 800; color: var(--primary); display: flex; align-items: center; gap: 12px; margin-bottom: 40px; }
        
        .nav-links { list-style: none; flex: 1; }
        .nav-item {
            display: flex; align-items: center; gap: 12px; padding: 14px 16px;
            color: var(--text-muted); border-radius: 12px; cursor: pointer;
            margin-bottom: 8px; font-weight: 600; font-size: 14px; transition: 0.2s all;
        }
        .nav-item:hover { background-color: var(--bg-body); color: var(--primary); }
        .nav-item.active { background-color: var(--primary); color: white; box-shadow: 0 10px 15px -3px rgba(99, 102, 241, 0.3); }

        .main { margin-left: 280px; flex: 1; padding: 40px; width: calc(100% - 280px); }

        /* COMPONENTS */
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
        
        .search-box {
            background: var(--bg-card); border: 1px solid var(--border); padding: 12px 20px;
            border-radius: 14px; display: flex; align-items: center; width: 400px;
            box-shadow: var(--shadow-sm);
        }
        .search-box:focus-within { border-color: var(--primary); }
        .search-box input { border: none; outline: none; background: transparent; margin-left: 12px; width: 100%; color: var(--text-main); font-size: 14px; }

        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 24px; margin-bottom: 40px; }
        .stat-card {
            background: var(--bg-card); padding: 28px; border-radius: 24px;
            border: 1px solid var(--border); box-shadow: var(--shadow-sm);
            display: flex; align-items: center; justify-content: space-between;
        }
        .stat-icon { width: 56px; height: 56px; border-radius: 16px; display: flex; align-items: center; justify-content: center; font-size: 24px; }

        .charts-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 24px; margin-bottom: 40px; }
        @media (max-width: 1100px) { .charts-grid { grid-template-columns: 1fr; } }

        .card { background: var(--bg-card); border-radius: 24px; border: 1px solid var(--border); padding: 24px; box-shadow: var(--shadow-sm); }

        /* TABLES */
        .table-wrapper { background: var(--bg-card); border-radius: 24px; border: 1px solid var(--border); overflow: hidden; }
        .table-header { padding: 24px; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        table { width: 100%; border-collapse: collapse; }
        th { padding: 16px 24px; background: var(--bg-body); color: var(--text-muted); font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }
        td { padding: 18px 24px; border-bottom: 1px solid var(--border); font-size: 14px; color: var(--text-main); }
        
        /* VENDOR GRID */
        .vendor-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 24px; }
        .vendor-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 20px; padding: 24px; transition: 0.2s; position: relative; }
        .vendor-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-md); border-color: var(--primary-light); }
        .vendor-actions { position: absolute; top: 20px; right: 20px; }

        /* SETTINGS GRID */
        .settings-grid { display: grid; grid-template-columns: 1fr 2fr; gap: 30px; }

        /* UI ELEMENTS */
        .btn { padding: 12px 24px; border-radius: 12px; border: none; font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; gap: 8px; font-size: 14px; transition: 0.2s; }
        .btn-primary { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text-main); }
        .btn-outline:hover { background: var(--bg-body); }
        
        .badge { padding: 6px 12px; border-radius: 10px; font-size: 11px; font-weight: 700; text-transform: uppercase; }
        .badge-success { background: rgba(16, 185, 129, 0.1); color: #10b981; }
        .badge-warning { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }
        .badge-danger { background: rgba(239, 68, 68, 0.1); color: #ef4444; }

        /* MODAL */
        .modal { position: fixed; inset: 0; background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(8px); display: none; justify-content: center; align-items: center; z-index: 1000; padding: 20px; }
        .modal.active { display: flex; }
        .modal-content { background: var(--bg-card); width: 100%; max-width: 500px; border-radius: 28px; padding: 40px; box-shadow: var(--shadow-lg); }

        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-size: 13px; font-weight: 600; color: var(--text-muted); }
        .form-control { width: 100%; padding: 14px; border-radius: 12px; border: 1px solid var(--border); background: var(--bg-body); color: var(--text-main); outline: none; }
        .form-control:focus { border-color: var(--primary); }

        .section { display: none; }
        .section.active { display: block; animation: fadeInUp 0.5s ease; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .empty-state { padding: 60px; text-align: center; color: var(--text-muted); }
        .toast-container { position: fixed; bottom: 30px; right: 30px; z-index: 9999; }
        .toast { background: var(--bg-card); border: 1px solid var(--border); padding: 16px 24px; border-radius: 16px; box-shadow: var(--shadow-lg); display: flex; align-items: center; gap: 12px; margin-top: 10px; animation: slideIn 0.3s forwards; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

        @media (max-width: 1024px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.active { transform: translateX(0); }
            .main { margin-left: 0; width: 100%; padding: 20px; }
            .mobile-toggle { display: block !important; }
            .settings-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="toast-container" id="toastContainer"></div>

<div class="wrapper">
    <aside class="sidebar" id="sidebar">
        <div class="logo"><i class="fas fa-layer-group"></i> Asseta</div>
        <ul class="nav-links">
            <li class="nav-item active" onclick="switchTab('dashboard', this)"><i class="fas fa-chart-line"></i> Dashboard</li>
            <li class="nav-item" onclick="switchTab('assets', this)"><i class="fas fa-boxes-stacked"></i> Assets</li>
            <li class="nav-item" onclick="switchTab('products', this)"><i class="fas fa-tags"></i> Products</li>
            <li class="nav-item" onclick="switchTab('vendors', this)"><i class="fas fa-store"></i> Vendors</li>
            <li class="nav-item" onclick="switchTab('users', this)"><i class="fas fa-user-gear"></i> User Directory</li>
            <li class="nav-item" onclick="switchTab('settings', this)"><i class="fas fa-sliders-h"></i> Settings</li>
        </ul>
        <div style="margin-top: auto;">
            <button class="nav-item" style="width: 100%; border: none; background: transparent;" onclick="logout()">
                <i class="fas fa-arrow-right-from-bracket"></i> Logout
            </button>
        </div>
    </aside>

    <main class="main">
        <header class="top-bar">
            <div style="display: flex; align-items: center; gap: 15px;">
                <button class="btn btn-outline mobile-toggle" style="display: none;" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
                <h1 id="pageTitle" style="font-size: 28px; font-weight: 800; letter-spacing: -0.5px;">Dashboard Overview</h1>
            </div>
            <div style="display: flex; align-items: center; gap: 20px;">
                <div class="search-box">
                    <i class="fas fa-search" style="color: var(--text-muted);"></i>
                    <input type="text" id="mainSearch" placeholder="Search..." onkeyup="handleGlobalSearch()">
                </div>
                <button class="btn btn-outline" style="border-radius: 14px; padding: 12px;" onclick="toggleTheme()" id="themeBtn"><i class="fas fa-moon"></i></button>
            </div>
        </header>

        <section id="dashboard" class="section active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div>
                        <p style="color: var(--text-muted); font-size: 13px; font-weight: 700;">TOTAL ASSETS</p>
                        <h2 style="font-size: 32px; margin-top: 5px;" id="statTotal">0</h2>
                    </div>
                    <div class="stat-icon" style="background: rgba(99, 102, 241, 0.1); color: var(--primary);"><i class="fas fa-box"></i></div>
                </div>
                <div class="stat-card">
                    <div>
                        <p style="color: var(--text-muted); font-size: 13px; font-weight: 700;">TOTAL PRODUCTS</p>
                        <h2 style="font-size: 32px; margin-top: 5px;" id="statProducts">0</h2>
                    </div>
                    <div class="stat-icon" style="background: rgba(236, 72, 153, 0.1); color: var(--secondary);"><i class="fas fa-tags"></i></div>
                </div>
                <div class="stat-card">
                    <div>
                        <p style="color: var(--text-muted); font-size: 13px; font-weight: 700;">VENDORS</p>
                        <h2 style="font-size: 32px; margin-top: 5px;" id="statVendors">0</h2>
                    </div>
                    <div class="stat-icon" style="background: rgba(16, 185, 129, 0.1); color: var(--success);"><i class="fas fa-store"></i></div>
                </div>
            </div>
            <div class="charts-grid">
                <div class="card">
                    <h3 style="margin-bottom: 25px; font-size: 18px;">Asset Value Growth (Last 6 Months)</h3>
                    <div style="height: 350px;"><canvas id="growthChart"></canvas></div>
                </div>
                <div class="card">
                    <h3 style="margin-bottom: 25px; font-size: 18px;">Operational Status</h3>
                    <div style="height: 350px; display: flex; align-items: center; justify-content: center;"><canvas id="statusChart"></canvas></div>
                </div>
            </div>
        </section>

        <section id="assets" class="section">
            <div class="table-wrapper">
                <div class="table-header">
                    <h3>Asset Inventory</h3>
                    <button class="btn btn-primary" onclick="openAssetModal()"><i class="fas fa-plus"></i> Add Asset</button>
                </div>
                <div style="overflow-x: auto;">
                    <table id="assetTable">
                        <thead>
                            <tr><th>Item Name</th><th>Category</th><th>User</th><th>Status</th><th>Cost</th><th style="text-align:right;">Action</th></tr>
                        </thead>
                        <tbody id="assetTableBody"></tbody>
                    </table>
                    <div id="assetEmpty" class="empty-state" style="display:none;">No assets found.</div>
                </div>
            </div>
        </section>

        <section id="products" class="section">
            <div class="table-wrapper">
                <div class="table-header">
                    <h3>Product Stock</h3>
                    <button class="btn btn-primary" onclick="openProductModal()"><i class="fas fa-plus"></i> Add Product</button>
                </div>
                <div style="overflow-x: auto;">
                    <table id="productTable">
                        <thead>
                            <tr><th>Product Name</th><th>SKU Code</th><th>Stock Qty</th><th>Price</th><th>Status</th><th style="text-align:right;">Action</th></tr>
                        </thead>
                        <tbody id="productTableBody"></tbody>
                    </table>
                    <div id="productEmpty" class="empty-state" style="display:none;">No products found.</div>
                </div>
            </div>
        </section>

        <section id="vendors" class="section">
            <div style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                <h3>Partner Vendors</h3>
                <button class="btn btn-primary" onclick="openVendorModal()"><i class="fas fa-plus"></i> Add Vendor</button>
            </div>
            <div id="vendorGrid" class="vendor-grid"></div>
            <div id="vendorEmpty" class="empty-state" style="display:none;">No vendors registered.</div>
        </section>

        <section id="users" class="section">
            <div class="card">
                <h3>User Directory</h3>
                <div class="stats-grid" style="margin-top: 25px;">
                    <div style="display: flex; align-items: center; gap: 15px; padding: 15px; border: 1px solid var(--border); border-radius: 15px;">
                        <img src="https://ui-avatars.com/api/?name=Ishan+Pandya&background=6366f1&color=fff" style="width: 50px; border-radius: 12px;">
                        <div><p style="font-weight: 700;">Ishan Pandya</p><p style="font-size: 12px; color: var(--text-muted);">Admin</p></div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 15px; padding: 15px; border: 1px solid var(--border); border-radius: 15px;">
                        <img src="https://ui-avatars.com/api/?name=Sarah+Chen&background=ec4899&color=fff" style="width: 50px; border-radius: 12px;">
                        <div><p style="font-weight: 700;">Sarah Chen</p><p style="font-size: 12px; color: var(--text-muted);">Manager</p></div>
                    </div>
                </div>
            </div>
        </section>

        <section id="settings" class="section">
             <div class="settings-grid">
                <div class="card">
                    <div style="text-align: center; padding: 20px;">
                        <img src="https://ui-avatars.com/api/?name=Admin+User&background=0f172a&color=fff&size=128" style="width: 100px; border-radius: 50%; margin-bottom: 15px;">
                        <h3>Admin User</h3>
                        <p style="color: var(--text-muted); font-size: 14px;">admin@asseta.com</p>
                        <button class="btn btn-outline" style="margin-top: 15px; width: 100%;">Edit Profile</button>
                    </div>
                </div>
                <div class="card">
                    <h3 style="margin-bottom: 20px;">System Preferences</h3>
                    <div class="form-group">
                        <label>Currency</label>
                        <select class="form-control"><option>USD ($)</option><option>INR (â‚¹)</option></select>
                    </div>
                    <div class="form-group">
                        <label>Email Notifications</label>
                        <div style="display: flex; gap: 20px; margin-top: 10px;">
                            <label style="display: flex; align-items: center; gap: 8px; font-weight: 400;"><input type="checkbox" checked> Low Stock Alerts</label>
                            <label style="display: flex; align-items: center; gap: 8px; font-weight: 400;"><input type="checkbox" checked> New Signups</label>
                        </div>
                    </div>
                    <hr style="border: 0; border-top: 1px solid var(--border); margin: 20px 0;">
                    <div class="form-group">
                        <label style="color: var(--danger);">Danger Zone</label>
                        <button class="btn btn-outline" style="color: var(--danger); border-color: var(--danger); margin-top: 5px;" onclick="resetData()">Factory Reset Data</button>
                    </div>
                </div>
             </div>
        </section>
    </main>
</div>

<div class="modal" id="assetModal">
    <div class="modal-content">
        <h2 style="margin-bottom: 20px;">Manage Asset</h2>
        <input type="hidden" id="assetIndex">
        <div class="form-group"><label>Asset Name</label><input type="text" id="aName" class="form-control"></div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="form-group"><label>Category</label><select id="aCat" class="form-control"><option>Laptop</option><option>Monitor</option><option>Furniture</option><option>Electronics</option><option>Accessories</option></select></div>
            <div class="form-group"><label>Status</label><select id="aStatus" class="form-control"><option>Active</option><option>Repair</option></select></div>
        </div>
        <div class="form-group"><label>User</label><input type="text" id="aUser" class="form-control"></div>
        <div class="form-group"><label>Cost ($)</label><input type="number" id="aCost" class="form-control"></div>
        <div style="display: flex; justify-content: flex-end; gap: 10px;">
            <button class="btn btn-outline" onclick="closeModals()">Cancel</button>
            <button class="btn btn-primary" onclick="saveAsset()">Save</button>
        </div>
    </div>
</div>

<div class="modal" id="productModal">
    <div class="modal-content">
        <h2 style="margin-bottom: 20px;">Manage Product</h2>
        <input type="hidden" id="prodIndex">
        <div class="form-group"><label>Product Name</label><input type="text" id="pName" class="form-control"></div>
        <div class="form-group"><label>SKU / Code</label><input type="text" id="pSku" class="form-control"></div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <div class="form-group"><label>Stock Qty</label><input type="number" id="pStock" class="form-control"></div>
            <div class="form-group"><label>Price ($)</label><input type="number" id="pPrice" class="form-control"></div>
        </div>
        <div style="display: flex; justify-content: flex-end; gap: 10px;">
            <button class="btn btn-outline" onclick="closeModals()">Cancel</button>
            <button class="btn btn-primary" onclick="saveProduct()">Save</button>
        </div>
    </div>
</div>

<div class="modal" id="vendorModal">
    <div class="modal-content">
        <h2 style="margin-bottom: 20px;">Manage Vendor</h2>
        <input type="hidden" id="vendIndex">
        <div class="form-group"><label>Company Name</label><input type="text" id="vName" class="form-control"></div>
        <div class="form-group"><label>Contact Person</label><input type="text" id="vPerson" class="form-control"></div>
        <div class="form-group"><label>Email</label><input type="email" id="vEmail" class="form-control"></div>
        <div class="form-group"><label>Phone</label><input type="tel" id="vPhone" class="form-control"></div>
        <div style="display: flex; justify-content: flex-end; gap: 10px;">
            <button class="btn btn-outline" onclick="closeModals()">Cancel</button>
            <button class="btn btn-primary" onclick="saveVendor()">Save</button>
        </div>
    </div>
</div>

<script>
    // DUMMY DATA FOR DASHBOARD FILL (EXPANDED)
    let assets = JSON.parse(localStorage.getItem('assets')) || [
        { name: "MacBook Pro M3", category: "Laptop", user: "Ishan", status: "Active", cost: 2499 },
        { name: "Dell UltraSharp 32", category: "Monitor", user: "Sarah", status: "Active", cost: 899 },
        { name: "Herman Miller Aeron", category: "Furniture", user: "John", status: "Repair", cost: 1400 },
        { name: "iPhone 15 Pro", category: "Mobile", user: "Ishan", status: "Active", cost: 1099 },
        { name: "iPad Pro 12.9", category: "Tablet", user: "Manager", status: "Active", cost: 1199 },
        { name: "Logitech MX Master 3", category: "Accessories", user: "Paru", status: "Active", cost: 99 },
        { name: "ErgoChair Pro", category: "Furniture", user: "Alice", status: "Active", cost: 499 },
        { name: "Lenovo ThinkPad X1", category: "Laptop", user: "David", status: "Repair", cost: 1399 },
        { name: "Samsung Odyssey G9", category: "Monitor", user: "Ishan", status: "Active", cost: 1299 },
        { name: "Standing Desk Explorer", category: "Furniture", user: "Sarah", status: "Active", cost: 650 },
        { name: "Sony A7IV Camera", category: "Electronics", user: "Marketing Team", status: "Active", cost: 2499 },
        { name: "Cisco Catalyst Switch", category: "Electronics", user: "IT Dept", status: "Active", cost: 850 },
        { name: "AirPods Pro 2", category: "Accessories", user: "John", status: "Active", cost: 249 }
    ];
    let products = JSON.parse(localStorage.getItem('products')) || [
        { name: "Wireless Mouse", sku: "LOG-001", stock: 45, price: 25 },
        { name: "Mechanical Keyboard", sku: "KEY-882", stock: 8, price: 120 },
        { name: "USB-C Hub", sku: "HUB-109", stock: 112, price: 45 },
        { name: "Webcam 4K", sku: "CAM-04", stock: 15, price: 199 },
        { name: "Noise Cancelling Headphones", sku: "AUD-102", stock: 25, price: 299 },
        { name: "Standing Desk Converter", sku: "FUR-004", stock: 5, price: 150 },
        { name: "27-inch 4K Monitor", sku: "MON-274K", stock: 12, price: 350 },
        { name: "Ergonomic Office Chair", sku: "FUR-099", stock: 2, price: 250 },
        { name: "Portable SSD 1TB", sku: "STO-1TB", stock: 50, price: 89 },
        { name: "Wireless Charging Pad", sku: "ACC-011", stock: 200, price: 25 }
    ];
    let vendors = JSON.parse(localStorage.getItem('vendors')) || [
        { name: "TechSolutions Inc", person: "John Doe", email: "john@tech.com", phone: "+1 234 567 890" },
        { name: "Apple Enterprise", person: "Alice Smith", email: "corp@apple.com", phone: "+1 999 888 777" },
        { name: "Office Depot", person: "Mike Ross", email: "mike@office.com", phone: "+1 555 444 333" },
        { name: "NARMAHI Tech Solutions", person: "Ishan Pandya", email: "contact@narmahi.com", phone: "+91 98765 43210" },
        { name: "Dell Technologies", person: "Michael Dell", email: "sales@dell.com", phone: "+1 800 123 456" },
        { name: "Logitech B2B", person: "Sarah Jenkins", email: "b2b@logitech.com", phone: "+1 888 777 666" },
        { name: "Amazon Business", person: "Account Manager", email: "support@amazon.com", phone: "+1 888 280 4331" }
    ];

    let charts = {};

    window.onload = () => { 
        applyTheme(); 
        initCharts(); 
        refreshAll(); 
    };

    function refreshAll() {
        renderAssets();
        renderProducts();
        renderVendors();
        updateStats();
        updateCharts();
        saveData();
    }

    function saveData() {
        localStorage.setItem('assets', JSON.stringify(assets));
        localStorage.setItem('products', JSON.stringify(products));
        localStorage.setItem('vendors', JSON.stringify(vendors));
    }

    function updateStats() {
        document.getElementById('statTotal').innerText = assets.length;
        document.getElementById('statProducts').innerText = products.length;
        document.getElementById('statVendors').innerText = vendors.length;
    }

    function renderAssets() {
        const tbody = document.getElementById('assetTableBody');
        tbody.innerHTML = assets.map((a, i) => `
            <tr>
                <td><b>${a.name}</b></td>
                <td>${a.category}</td>
                <td>${a.user}</td>
                <td><span class="badge ${a.status==='Active'?'badge-success':'badge-warning'}">${a.status}</span></td>
                <td>$${a.cost}</td>
                <td style="text-align:right;">
                    <button class="btn btn-outline" style="padding:6px 10px;" onclick="editAsset(${i})"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-outline" style="padding:6px 10px; color:var(--danger);" onclick="delAsset(${i})"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
        `).join('');
        document.getElementById('assetEmpty').style.display = assets.length ? 'none' : 'block';
    }

    function renderProducts() {
        const tbody = document.getElementById('productTableBody');
        tbody.innerHTML = products.map((p, i) => `
            <tr>
                <td><b>${p.name}</b></td>
                <td>${p.sku}</td>
                <td>${p.stock}</td>
                <td>$${p.price}</td>
                <td><span class="badge ${p.stock > 10 ? 'badge-success' : 'badge-danger'}">${p.stock > 10 ? 'In Stock' : 'Low Stock'}</span></td>
                <td style="text-align:right;">
                    <button class="btn btn-outline" style="padding:6px 10px;" onclick="editProduct(${i})"><i class="fas fa-edit"></i></button>
                    <button class="btn btn-outline" style="padding:6px 10px; color:var(--danger);" onclick="delProduct(${i})"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
        `).join('');
        document.getElementById('productEmpty').style.display = products.length ? 'none' : 'block';
    }

    function renderVendors() {
        const grid = document.getElementById('vendorGrid');
        grid.innerHTML = vendors.map((v, i) => `
            <div class="vendor-card">
                <div class="vendor-actions">
                    <button class="btn btn-outline" style="padding:5px;" onclick="editVendor(${i})"><i class="fas fa-pen"></i></button>
                    <button class="btn btn-outline" style="padding:5px; color:var(--danger);" onclick="delVendor(${i})"><i class="fas fa-trash"></i></button>
                </div>
                <div style="width:40px; height:40px; background:var(--bg-body); border-radius:10px; display:flex; align-items:center; justify-content:center; margin-bottom:15px; color:var(--primary);">
                    <i class="fas fa-building"></i>
                </div>
                <h4 style="margin-bottom:5px;">${v.name}</h4>
                <p style="font-size:13px; color:var(--text-muted); margin-bottom:15px;"><i class="fas fa-user"></i> ${v.person}</p>
                <div style="font-size:13px; color:var(--text-main);">
                    <div style="margin-bottom:5px;"><i class="fas fa-envelope" style="width:20px; color:var(--text-muted);"></i> ${v.email}</div>
                    <div><i class="fas fa-phone" style="width:20px; color:var(--text-muted);"></i> ${v.phone}</div>
                </div>
            </div>
        `).join('');
        document.getElementById('vendorEmpty').style.display = vendors.length ? 'none' : 'block';
    }

    // CRUD FUNCTIONS
    function openAssetModal() { document.getElementById('assetModal').classList.add('active'); document.getElementById('assetIndex').value = ''; }
    function editAsset(i) { 
        document.getElementById('assetIndex').value = i; 
        document.getElementById('aName').value = assets[i].name; 
        document.getElementById('aCat').value = assets[i].category; 
        document.getElementById('aStatus').value = assets[i].status; 
        document.getElementById('aUser').value = assets[i].user; 
        document.getElementById('aCost').value = assets[i].cost; 
        document.getElementById('assetModal').classList.add('active'); 
    }
    function saveAsset() {
        const item = { name: document.getElementById('aName').value, category: document.getElementById('aCat').value, status: document.getElementById('aStatus').value, user: document.getElementById('aUser').value, cost: document.getElementById('aCost').value };
        if(!item.name) return alert('Name required');
        const idx = document.getElementById('assetIndex').value;
        idx === '' ? assets.push(item) : assets[idx] = item;
        closeModals(); refreshAll(); showToast('Asset Saved');
    }
    function delAsset(i) { if(confirm('Delete?')) { assets.splice(i,1); refreshAll(); } }

    function openProductModal() { document.getElementById('productModal').classList.add('active'); document.getElementById('prodIndex').value = ''; }
    function editProduct(i) {
        document.getElementById('prodIndex').value = i;
        document.getElementById('pName').value = products[i].name;
        document.getElementById('pSku').value = products[i].sku;
        document.getElementById('pStock').value = products[i].stock;
        document.getElementById('pPrice').value = products[i].price;
        document.getElementById('productModal').classList.add('active');
    }
    function saveProduct() {
        const item = { name: document.getElementById('pName').value, sku: document.getElementById('pSku').value, stock: document.getElementById('pStock').value, price: document.getElementById('pPrice').value };
        if(!item.name) return alert('Name required');
        const idx = document.getElementById('prodIndex').value;
        idx === '' ? products.push(item) : products[idx] = item;
        closeModals(); refreshAll(); showToast('Product Saved');
    }
    function delProduct(i) { if(confirm('Delete?')) { products.splice(i,1); refreshAll(); } }

    function openVendorModal() { document.getElementById('vendorModal').classList.add('active'); document.getElementById('vendIndex').value = ''; }
    function editVendor(i) {
        document.getElementById('vendIndex').value = i;
        document.getElementById('vName').value = vendors[i].name;
        document.getElementById('vPerson').value = vendors[i].person;
        document.getElementById('vEmail').value = vendors[i].email;
        document.getElementById('vPhone').value = vendors[i].phone;
        document.getElementById('vendorModal').classList.add('active');
    }
    function saveVendor() {
        const item = { name: document.getElementById('vName').value, person: document.getElementById('vPerson').value, email: document.getElementById('vEmail').value, phone: document.getElementById('vPhone').value };
        if(!item.name) return alert('Name required');
        const idx = document.getElementById('vendIndex').value;
        idx === '' ? vendors.push(item) : vendors[idx] = item;
        closeModals(); refreshAll(); showToast('Vendor Saved');
    }
    function delVendor(i) { if(confirm('Delete?')) { vendors.splice(i,1); refreshAll(); } }

    function closeModals() { document.querySelectorAll('.modal').forEach(m => m.classList.remove('active')); }

    // UTILS
    function switchTab(id, el) {
        document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active');
        document.getElementById('pageTitle').innerText = id.charAt(0).toUpperCase() + id.slice(1) + ' Overview';
        if(window.innerWidth <= 1024) toggleSidebar();
    }
    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); }
    function showToast(msg) {
        const t = document.createElement('div'); t.className = 'toast';
        t.innerHTML = `<i class="fas fa-check-circle" style="color:var(--success)"></i> ${msg}`;
        document.getElementById('toastContainer').appendChild(t);
        setTimeout(() => t.remove(), 3000);
    }
    function toggleTheme() {
        document.body.classList.toggle('dark-theme');
        localStorage.setItem('theme', document.body.classList.contains('dark-theme') ? 'dark' : 'light');
        applyTheme();
    }
    function applyTheme() {
        const isDark = localStorage.getItem('theme') === 'dark';
        if(isDark) document.body.classList.add('dark-theme');
        document.getElementById('themeBtn').innerHTML = isDark ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
    }
    function resetData() { if(confirm('Reset all data?')) { localStorage.clear(); location.reload(); } }
    function logout() { showToast('Logging out...'); setTimeout(() => location.reload(), 1000); }
    
    function handleGlobalSearch() {
        const q = document.getElementById('mainSearch').value.toLowerCase();
        const assetsFiltered = assets.filter(a => a.name.toLowerCase().includes(q));
        const tbody = document.getElementById('assetTableBody');
        tbody.innerHTML = assetsFiltered.map((a, i) => `
            <tr>
                <td><b>${a.name}</b></td>
                <td>${a.category}</td>
                <td>${a.user}</td>
                <td><span class="badge ${a.status==='Active'?'badge-success':'badge-warning'}">${a.status}</span></td>
                <td>$${a.cost}</td>
                <td style="text-align:right;"><button class="btn btn-outline" style="padding:6px 10px;" onclick="editAsset(${i})"><i class="fas fa-edit"></i></button></td>
            </tr>
        `).join('');
    }

    // CHARTS INITIALIZATION WITH FAKE DATA
    function initCharts() {
        // Line Chart: Asset Value Growth
        charts.growth = new Chart(document.getElementById('growthChart'), {
            type: 'line',
            data: {
                labels: ['Sept', 'Oct', 'Nov', 'Dec', 'Jan', 'Feb'],
                datasets: [{ 
                    label: 'Asset Value ($)', 
                    data: [12000, 15500, 14200, 19000, 24000, 28500], // FAKE DATA
                    borderColor: '#6366f1', 
                    tension: 0.4, 
                    fill: true, 
                    backgroundColor: 'rgba(99, 102, 241, 0.1)' 
                }]
            },
            options: { 
                responsive: true, 
                maintainAspectRatio: false, 
                plugins: { legend: { display: false } }, 
                scales: { 
                    y: { beginAtZero: true, grid: { color: 'rgba(0,0,0,0.05)' } },
                    x: { grid: { display: false } } 
                } 
            }
        });

        // Doughnut Chart: Asset Status
        charts.status = new Chart(document.getElementById('statusChart'), {
            type: 'doughnut',
            data: { 
                labels: ['Active', 'Repair', 'Retired', 'Missing'], 
                datasets: [{ 
                    data: [65, 15, 12, 8], // FAKE DATA
                    backgroundColor: ['#10b981', '#f59e0b', '#64748b', '#ef4444'], 
                    borderWidth: 0 
                }] 
            },
            options: { 
                responsive: true, 
                cutout: '75%', 
                plugins: { 
                    legend: { position: 'bottom', labels: { usePointStyle: true, padding: 20 } } 
                } 
            }
        });
    }

    function updateCharts() {
        if(!charts.status) return;
        // Updating Doughnut Chart based on real array length
        const activeCount = assets.filter(a=>a.status==='Active').length;
        const repairCount = assets.filter(a=>a.status==='Repair').length;
        
        // If arrays are empty, use dummy distribution, otherwise use real data
        if(activeCount > 0 || repairCount > 0) {
            charts.status.data.datasets[0].data = [activeCount, repairCount, 2, 1];
            charts.status.update();
        }
    }
</script>

</body>
</html>